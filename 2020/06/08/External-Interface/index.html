
<!DOCTYPE html>
<html lang="en">


<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#202020"/>
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
  
  
    <meta name="keywords" content="linux java android" />
  

  
    <meta name="description" content="description" />
  
  
  <link rel="icon" type="image/x-icon" href="/logo.png">
  <title>External Interface [ River Young ]</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css">
    
      <link rel="stylesheet" href="/css/xoxo.css">
    
  
<meta name="generator" content="Hexo 4.2.1"></head>


<body>
  <div class="nav-container">
    <nav class="home-menu pure-menu pure-menu-horizontal">
  <a class="pure-menu-heading" href="/">
    <img class="avatar" src="http://yoursite.com/images/logo.png">
    <span class="title">River Young</span>
  </a>

  <ul class="pure-menu-list clearfix">
      
          
            <li class="pure-menu-item"><a href="/" class="pure-menu-link">Home</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/archives" class="pure-menu-link">Archives</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/tags" class="pure-menu-link">Tags</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/search" class="pure-menu-link">Search</a></li>
          
      
          
            <li class="pure-menu-item"><a href="https://0xff000000.com" target="_blank" rel="noopener" class="pure-menu-link">About</a></li>
          
      
          
            <li class="pure-menu-item"><a href="/atom.xml" class="pure-menu-link">RSS</a></li>
          
      
  </ul>
   
</nav>
  </div>

  <div class="container" id="content-outer">
    <div class="inner" id="content-inner">
      <div class="post-container">
  <article class="post" id="post">
    <header class="post-header text-center">
      <h1 class="title">
        External Interface
      </h1>
      <span>
        
        <time class="time" datetime="2020-06-08T14:08:01.000Z">
        2020-06-08
      </time>
        
      </span>
      <span class="slash">/</span>
      <span class="post-meta">
      <span class="post-tags">
        
      </span>
    </span>
      <span class="slash">/</span>
      <span class="read">
      <span id="busuanzi_value_page_pv"></span> 点击
    </span>
      <span class="slash">/</span>
    </header>

    <div class="post-content">
      <h1 id="外设接口"><a href="#外设接口" class="headerlink" title="外设接口"></a>外设接口</h1><h2 id="IIC"><a href="#IIC" class="headerlink" title="IIC"></a>IIC</h2><p>​    IIC(Inter-Integrated Circuit/集成电路总线），这种总线类型是一种<strong>简单、双向二线制同步串行总线</strong>。它只需要两根线（<a href="https://baike.baidu.com/item/SDA" target="_blank" rel="noopener">SDA</a>（串行数据线）和<a href="https://baike.baidu.com/item/SCL" target="_blank" rel="noopener">SCL</a>（串行时钟线））即可在连接于总线上的器件之间传送信息。 串行的8位双向数据传输位速率在标准模式下可达100Kbit/s，快速模式下可达400Kbit/s，高速模式下可达3．4Mbit/s。速度不快，但通用性强，适合于各种传感器、小IC，小MCU，控制指令以及小数据量的传输</p>
<p>​      连接在同一IIC总线结构下的多个芯片都可以作为实时数据传输的控制源。主器件用于启动总线传送数据，并产生时钟以开放传送的器件，此时任何被寻址的器件均被认为是从器件．在总线上主和从、发和收的关系不是恒定的，而取决于此时数据传送方向。如果主机要发送数据给从器件，则主机首先寻址从器件，然后主动发送数据至从器件，最后由主机终止数据传送；如果主机要接收从器件的数据，首先由主器件寻址从器件．然后主机接收从器件发送的数据，最后由主机终止接收过程。在这种情况下．主机负责产生定时时钟和终止数据传送。</p>
<h3 id="IIC时序图"><a href="#IIC时序图" class="headerlink" title="IIC时序图"></a>IIC时序图</h3><p><img src="E:%5C%E6%96%87%E6%A1%A3%E7%A7%AF%E7%B4%AF%5CtyporaPic%5C1586840052836.png" alt="1586840052836"></p>
<p><img src="E:%5C%E6%96%87%E6%A1%A3%E7%A7%AF%E7%B4%AF%5CtyporaPic%5C1586840067166.png" alt="1586840067166"></p>
<h3 id="IIC实测波形"><a href="#IIC实测波形" class="headerlink" title="IIC实测波形"></a>IIC实测波形</h3><p><img src="E:%5C%E6%96%87%E6%A1%A3%E7%A7%AF%E7%B4%AF%5CtyporaPic%5C1586840082874.png" alt="1586840082874"></p>
<p>​    由图中可知时序如下：</p>
<ol>
<li>由主机发起，在SCL为高电平时，SDL由高到低切边，形成开始信号；</li>
<li>接着7位地址和一位读写标志，这里7位地址为0111100，即为0x3c，最后一位0表示写操作；</li>
<li>接着再下一个时钟，主机以高电平状态释放SDA，这时从机响应，将SDA拉低；</li>
<li>接着两个8位数据00101110与响应，即0x2e；</li>
<li>还有其它数据和最后的停止位，图中被截掉了；</li>
</ol>
<h3 id="带中断的数据传输"><a href="#带中断的数据传输" class="headerlink" title="带中断的数据传输"></a>带中断的数据传输</h3><p>​    IIC只能由主机[cpu]去找外设[从机]索取数据，外设不能主动发送数据给CPU，但是CPU不能定期去问外设“你有没有数据要发给我？”，这样耗CPU的计算资源，也耗电，且无法进入睡眠状态。因此需要外设有办法通知CPU，“我有数据要发了”。<strong>I2C配合的中断信号</strong>就是这个作用。外设有数据要发了，先发个中断给CPU，CPU再来通过I2C读取外设想要发过来的数据。对于低功耗应用的场景、能够触发的外设场景，都需要这么来设计。例如电容触摸屏，平时CPU是休眠的，点击一下就唤醒系统。再例如G-Sensor运动传感器，一旦被晃动了就唤醒CPU。</p>
<p><img src="C:/Users/yangjianghe/AppData/Roaming/Typora/typora-user-images/1586839939104.png" alt="1586839939104"></p>
<p>​      发送到SDA 线上的每个字节必须为8 位，每次传输可以发送的字节数量不受限制。每个字节后必须跟一个响应位。首先传输的是数据的最高位（MSB），如果从机要完成一些其他功能后（例如一个内部中断服务程序）才能接收或发送下一个完整的数据字节，可以使时钟线SCL 保持低电平，迫使主机进入等待状态，当从机准备好接收下一个数据字节并释放时钟线SCL 后数据传输继续。</p>
<h3 id="如何一对多？"><a href="#如何一对多？" class="headerlink" title="如何一对多？"></a>如何一对多？</h3><p>​    一根I2C总线上挂载多个设备，那么岂不是CPU发个什么数据，所有的外设都可以看得到？是的，就这样子的。只不过CPU先会发一个地址，所有的外设都会收到这个地址。这个地址就好比外设的名字。叫了你了，你就答应，没叫你就别答应。</p>
<h3 id="地址冲突怎么办？"><a href="#地址冲突怎么办？" class="headerlink" title="地址冲突怎么办？"></a>地址冲突怎么办？</h3><p>​    IIC设备的地址是固定的，比如0x50，0x60等等，因为只有127个地址，因此地址冲突是很常见的，所以一般设备都会有地址选择pin。但是如果无论如何还是有芯片冲突，那就没有办法了，只能换芯片了。</p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><h4 id="EEPROM：BR24G02-3"><a href="#EEPROM：BR24G02-3" class="headerlink" title="EEPROM：BR24G02-3"></a>EEPROM：BR24G02-3</h4><p><img src="E:%5C%E6%96%87%E6%A1%A3%E7%A7%AF%E7%B4%AF%5CtyporaPic%5C1586840127260.png" alt="1586840127260"></p>
<h4 id="光感芯片：LTR-303ALS-01"><a href="#光感芯片：LTR-303ALS-01" class="headerlink" title="光感芯片：LTR-303ALS-01"></a>光感芯片：LTR-303ALS-01</h4><p>​    <img src="E:%5C%E6%96%87%E6%A1%A3%E7%A7%AF%E7%B4%AF%5CtyporaPic%5C1586840142490.png" alt="1586840142490"></p>
<h2 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h2><p>​    SPI（Serial Peripheral Interface，串行外设接口）是一种<strong>高速的，全双工，同步的通信总线</strong>，并且在芯片的管脚上只占用四根线，节约了芯片的管脚，同时为PCB的布局上节省空间</p>
<p><img src="E:%5C%E6%96%87%E6%A1%A3%E7%A7%AF%E7%B4%AF%5CtyporaPic%5C1586840162605.png" alt="1586840162605"></p>
<p>​     SPI的通信原理很简单，它以<strong>主从方式</strong>工作，这种模式通常有一个主设备和一个或多个从设备，需要至少4根线，事实上3根也可以（单向传输时）。也是所有基于SPI的设备共有的，它们是SDI（数据输入），SDO（数据输出），SCK（时钟），CS（片选）。</p>
<p>​    The SPI bus specifies four logic signals:</p>
<p>​    <strong>SCLK</strong>: Serial Clock (output from master)</p>
<p>​    <strong>MOSI</strong>: Master Output Slave Input, or Master Out Slave In (data output from master)</p>
<p>​    <strong>MISO</strong>: Master Input Slave Output, or Master In Slave Out (data output from slave)</p>
<p>​    <strong>SS</strong>: Slave Select (oftenactive low, output from master) </p>
<p>​    SPI是串行通讯协议，也就是说数据是一位一位的传输的。这就是SCLK时钟线存在的原因，由SCLK提供时钟脉冲，SDI，SDO则基于此脉冲完成数据传输。数据输出通过 SDO线，数据在时钟上升沿或下降沿时改变，在紧接着的下降沿或上升沿被读取。完成一位数据传输，输入也使用同样原理。因此，至少需要8次时钟信号的改变（上沿和下沿为一次），才能完成8位数据的传输。</p>
<h3 id="SPI传输时序"><a href="#SPI传输时序" class="headerlink" title="SPI传输时序"></a>SPI传输时序</h3><p><img src="E:%5C%E6%96%87%E6%A1%A3%E7%A7%AF%E7%B4%AF%5CtyporaPic%5C1587388050644.png" alt="1587388050644"></p>
<h3 id="SPI的缺点"><a href="#SPI的缺点" class="headerlink" title="SPI的缺点"></a>SPI的缺点</h3><p>​    没有指定的<strong>流控制</strong>，<strong>没有应答机制</strong>确认是否接收到数据。</p>
<h3 id="SPI经典连接"><a href="#SPI经典连接" class="headerlink" title="SPI经典连接"></a>SPI经典连接</h3><p><img src="E:%5C%E6%96%87%E6%A1%A3%E7%A7%AF%E7%B4%AF%5CtyporaPic%5C1587391530051.png" alt="1587391530051"></p>

    </div>

    <div>全文完。</div>
  </article>
  <div class="toc-container">
    
  <div id="toc" class="toc-article">
    <strong class="toc-title">Posts</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#外设接口"><span class="toc-text">外设接口</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#IIC"><span class="toc-text">IIC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IIC时序图"><span class="toc-text">IIC时序图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IIC实测波形"><span class="toc-text">IIC实测波形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#带中断的数据传输"><span class="toc-text">带中断的数据传输</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#如何一对多？"><span class="toc-text">如何一对多？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#地址冲突怎么办？"><span class="toc-text">地址冲突怎么办？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#使用场景"><span class="toc-text">使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EEPROM：BR24G02-3"><span class="toc-text">EEPROM：BR24G02-3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#光感芯片：LTR-303ALS-01"><span class="toc-text">光感芯片：LTR-303ALS-01</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SPI"><span class="toc-text">SPI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SPI传输时序"><span class="toc-text">SPI传输时序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SPI的缺点"><span class="toc-text">SPI的缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SPI经典连接"><span class="toc-text">SPI经典连接</span></a></li></ol></li></ol></li></ol>
  </div>


  </div>
</div>
<div class="copyright">
    <span>本作品采用</span>
    <a href="https://creativecommons.org/licenses/by/4.0/" target="_blank" rel="noopener">知识共享署名 4.0 国际许可协议</a>
    <span>进行许可。 转载时请注明原文链接。</span>
</div>
<div class="share" style="width: 100%;">
  <img src="https://kevinofneu-blog-static.oss-cn-beijing.aliyuncs.com/static/2018-12-10-qrcode_for_gh_ffacf5722095_258.jpg" alt="Running Geek" style="margin: auto; display: block;"/>

  <div style="margin: auto; text-align: center; font-size: 0.8em; color: grey;">老铁们关注走一走，不迷路</div>
  
</div>

  
    <div class="post-nav">
      <div class="post-nav-item post-nav-next">
        
          <span>〈 </span>
          <a href="/2020/06/06/myfirstArticle/" rel="next" title="myfirstArticle">
          myfirstArticle
          </a>
        
      </div>
  
      <div class="post-nav-item post-nav-prev">
          
      </div>
    </div>
  


    </div>

    

  </div>
  <footer class="footer text-center">
    <div id="bottom-inner">
        <a class="bottom-item" href="https://blog.0xff000000.com" target="_blank" rel="noopener">首页</a> |
        <a class="bottom-item" href="https://0xff000000.com" target="_blank">主站</a> |
        <a class="bottom-item" href="https://github.com/KevinOfNeu" target="_blank">GitHub</a> |
        <a class="bottom-item" href="https://hexo.io" target="_blank">Powered by hexo</a> |
        <a class="bottom-item" href="https://github.com/KevinOfNeu/hexo-theme-xoxo" target="_blank">Theme xoxo</a>
    </div>
</footer>
  

<script>
  (function(window, document, undefined) {

    var timer = null;

    function returnTop() {
      cancelAnimationFrame(timer);
      timer = requestAnimationFrame(function fn() {
        var oTop = document.body.scrollTop || document.documentElement.scrollTop;
        if (oTop > 0) {
          document.body.scrollTop = document.documentElement.scrollTop = oTop - 50;
          timer = requestAnimationFrame(fn);
        } else {
          cancelAnimationFrame(timer);
        }
      });
    }

    var hearts = [];
    window.requestAnimationFrame = (function() {
      return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function(callback) {
          setTimeout(callback, 1000 / 60);
        }
    })();
    init();

    function init() {
      css(".heart{z-index:9999;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;}.heart:after{top: -5px;}.heart:before{left: -5px;}");
      attachEvent();
      gameloop();
      addMenuEvent();
    }

    function gameloop() {
      for (var i = 0; i < hearts.length; i++) {
        if (hearts[i].alpha <= 0) {
          document.body.removeChild(hearts[i].el);
          hearts.splice(i, 1);
          continue;
        }
        hearts[i].y--;
        hearts[i].scale += 0.004;
        hearts[i].alpha -= 0.013;
        hearts[i].el.style.cssText = "left:" + hearts[i].x + "px;top:" + hearts[i].y + "px;opacity:" + hearts[i].alpha + ";transform:scale(" + hearts[i].scale + "," + hearts[i].scale + ") rotate(45deg);background:" + hearts[i].color;
      }
      requestAnimationFrame(gameloop);
    }

    /**
     * 给logo设置点击事件
     * 
     * - 回到顶部
     * - 出现爱心
     */
    function attachEvent() {
      var old = typeof window.onclick === "function" && window.onclick;
      var logo = document.getElementById("logo");
      if (logo) {
        logo.onclick = function(event) {
          returnTop();
          old && old();
          createHeart(event);
        }
      }
      
    }

    function createHeart(event) {
      var d = document.createElement("div");
      d.className = "heart";
      hearts.push({
        el: d,
        x: event.clientX - 5,
        y: event.clientY - 5,
        scale: 1,
        alpha: 1,
        color: randomColor()
      });
      document.body.appendChild(d);
    }

    function css(css) {
      var style = document.createElement("style");
      style.type = "text/css";
      try {
        style.appendChild(document.createTextNode(css));
      } catch (ex) {
        style.styleSheet.cssText = css;
      }
      document.getElementsByTagName('head')[0].appendChild(style);
    }

    function randomColor() {
      // return "rgb(" + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + ")";
      return "#F44336";
    }

    function addMenuEvent() {
      var menu = document.getElementById('menu-main-post');
      if (menu) {
        var toc = document.getElementById('toc');
        if (toc) {
          menu.onclick = function() {
            if (toc) {
              if (toc.style.display == 'block') {
                toc.style.display = 'none';
              } else {
                toc.style.display = 'block';
              }
            }
          };
        } else {
          menu.style.display = 'none';
        }
      }
    }

  })(window, document);
</script>

  



</body>
</html>
