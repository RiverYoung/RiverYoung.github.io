<!DOCTYPE html>
<html lang="zh-CN">
    <head>
    <meta charset="utf-8">

    

    <!--icon-->
    
        <link rel="shortcut icon" type='image/x-icon' href="/home/git/hexo/favicon.ico">
    

    <!-- 渲染优化 -->
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="HandheldFriendly" content="True" >
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!-- meta -->
    
    <title>External Interface | River Young</title>
    
        <meta name="keywords" content="linux java android">
    
    
        <meta name="description" content="科技呵护未来">
    

    <!--Social link-->
     
        <meta name="description" content="外设接口IIC​    IIC(Inter-Integrated Circuit&#x2F;集成电路总线），这种总线类型是一种简单、双向二线制同步串行总线。它只需要两根线（SDA（串行数据线）和SCL（串行时钟线))即可在连接于总线上的器件之间传送信息。 串行的8位双向数据传输位速率在标准模式下可达100Kbit&#x2F;s，快速模式下可达400Kbit&#x2F;s，高速模式下可达3．4Mbit&#x2F;s。速度不快，但通用性强，">
<meta property="og:type" content="article">
<meta property="og:title" content="External Interface">
<meta property="og:url" content="http://riveryoung.cn/2020/06/08/External-Interface/index.html">
<meta property="og:site_name" content="River Young">
<meta property="og:description" content="外设接口IIC​    IIC(Inter-Integrated Circuit&#x2F;集成电路总线），这种总线类型是一种简单、双向二线制同步串行总线。它只需要两根线（SDA（串行数据线）和SCL（串行时钟线))即可在连接于总线上的器件之间传送信息。 串行的8位双向数据传输位速率在标准模式下可达100Kbit&#x2F;s，快速模式下可达400Kbit&#x2F;s，高速模式下可达3．4Mbit&#x2F;s。速度不快，但通用性强，">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://riveryoung.cn/home/git/hexo/2020/06/08/External-Interface/1.png">
<meta property="og:image" content="http://riveryoung.cn/home/git/hexo/2020/06/08/External-Interface/2.png">
<meta property="og:image" content="http://riveryoung.cn/home/git/hexo/2020/06/08/External-Interface/1598547282809.png">
<meta property="og:image" content="c:/Users/yangjianghe/AppData/Roaming/Typora/typora-user-images/1586839939104.png">
<meta property="og:image" content="http://riveryoung.cn/home/git/hexo/2020/06/08/External-Interface/eeprom.png">
<meta property="og:image" content="http://riveryoung.cn/home/git/hexo/2020/06/08/External-Interface/ltr.png">
<meta property="og:image" content="http://riveryoung.cn/home/git/hexo/2020/06/08/External-Interface/spi.png">
<meta property="og:image" content="http://riveryoung.cn/home/git/hexo/2020/06/08/External-Interface/spi2.png">
<meta property="og:image" content="http://riveryoung.cn/home/git/hexo/2020/06/08/External-Interface/spi_connect.png">
<meta property="article:published_time" content="2020-06-08T15:01:21.000Z">
<meta property="article:modified_time" content="2020-08-27T16:55:08.199Z">
<meta property="article:author" content="River Young">
<meta property="article:tag" content="linux">
<meta property="article:tag" content="嵌入式">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://riveryoung.cn/home/git/hexo/2020/06/08/External-Interface/1.png">
    

    <!-- feed -->
    

    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-cards@0.3.0/dist/css/style.min.css">
 
    
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-theme-cards@0.1/dist/css/github.min.css" crossorigin="anonymous" media="none" onload="this.media='all'">
    

    <!--LaTex-->
    

     

    
        
             
        
             
        
    

<meta name="generator" content="Hexo 5.1.1"></head>

    <body>
        <div id="app">
            <header class="header">
    <div class="header__left">
        
            <a href="/home/git/hexo/" class="button">
                <span class="logo__text">
                    ← River Young | 首页
                </span>
            </a>
        
    </div>
    <div class="header__right">
        
         
    </div>
</header>


            <main class="main">
    <div class="post-title">
    <h1 class="post-title__text">
        External Interface
    </h1>
    <div class="post-title__meta">
        
            <a href="/home/git/hexo/archives/2020/06/" class="button" style="color: #808080;">
    2020-06-08
</a>
        
        
            
    <span class="separate-dot"></span><a href="/home/git/hexo/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" class="button">嵌入式</a>

 
        
        
     
 

  
    </div>
</div>


    <div class="post__with-side">
        <aside class="post-side">
            <div class="post-side__toc">
                <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#IIC"><span class="toc-text">IIC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IIC%E6%97%B6%E5%BA%8F%E5%9B%BE"><span class="toc-text">IIC时序图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IIC%E5%AE%9E%E6%B5%8B%E6%B3%A2%E5%BD%A2"><span class="toc-text">IIC实测波形</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%A6%E4%B8%AD%E6%96%AD%E7%9A%84%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93"><span class="toc-text">带中断的数据传输</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A6%82%E4%BD%95%E4%B8%80%E5%AF%B9%E5%A4%9A%EF%BC%9F"><span class="toc-text">如何一对多？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9D%80%E5%86%B2%E7%AA%81%E6%80%8E%E4%B9%88%E5%8A%9E%EF%BC%9F"><span class="toc-text">地址冲突怎么办？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EEPROM%EF%BC%9ABR24G02-3"><span class="toc-text">EEPROM：BR24G02-3</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%89%E6%84%9F%E8%8A%AF%E7%89%87%EF%BC%9ALTR-303ALS-01"><span class="toc-text">光感芯片：LTR-303ALS-01</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SPI"><span class="toc-text">SPI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SPI%E4%BC%A0%E8%BE%93%E6%97%B6%E5%BA%8F"><span class="toc-text">SPI传输时序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SPI%E7%9A%84%E7%BC%BA%E7%82%B9"><span class="toc-text">SPI的缺点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SPI%E7%BB%8F%E5%85%B8%E8%BF%9E%E6%8E%A5"><span class="toc-text">SPI经典连接</span></a></li></ol></li></ol>
            </div>
        </aside>

<article class="post content-card">
    <div class="post__header">
        
             
        
        
            
    <div class="post__expire" id="post-expired-notify">
        <p>
            本文最后更新于 <span id="expire-date"></span> 天前，文中部分描述可能已经过时。
        </p>
    </div>
    <script>
        (() => {
            var update = Date.parse("2020-08-28"),
                date = new Date(),
                now = date.getTime(),
                expire = now - update,
                expire_days = Math.floor(expire/(24*3600*1000));
            if (expire_days >= 120) {
                document.querySelectorAll('#expire-date')[0].innerHTML = expire_days;
                document.querySelectorAll('#post-expired-notify')[0].style.display = 'block';
            }
        })();
    </script>

        
    </div>
    <div class="post__content">
        <div class="markdown-body">
            <h1 id="外设接口"><a href="#外设接口" class="headerlink" title="外设接口"></a>外设接口</h1><h2 id="IIC"><a href="#IIC" class="headerlink" title="IIC"></a>IIC</h2><p>​    IIC(Inter-Integrated Circuit/集成电路总线），这种总线类型是一种<strong>简单、双向二线制同步串行总线</strong>。它只需要两根线（<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/SDA">SDA</a>（串行数据线）和<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/SCL">SCL</a>（串行时钟线))即可在连接于总线上的器件之间传送信息。 串行的8位双向数据传输位速率在标准模式下可达100Kbit/s，快速模式下可达400Kbit/s，高速模式下可达3．4Mbit/s。速度不快，但通用性强，适合于各种传感器、小IC，小MCU，控制指令以及小数据量的传输。</p>
<a id="more"></a>

<p>​    连接在同一IIC总线结构下的多个芯片都可以作为实时数据传输的控制源。主器件用于启动总线传送数据，并产生时钟以开放传送的器件，此时任何被寻址的器件均被认为是从器件．在总线上主和从、发和收的关系不是恒定的，而取决于此时数据传送方向。如果主机要发送数据给从器件，则主机首先寻址从器件，然后主动发送数据至从器件，最后由主机终止数据传送；如果主机要接收从器件的数据，首先由主器件寻址从器件．然后主机接收从器件发送的数据，最后由主机终止接收过程。在这种情况下．主机负责产生定时时钟和终止数据传送。</p>
<h3 id="IIC时序图"><a href="#IIC时序图" class="headerlink" title="IIC时序图"></a>IIC时序图</h3><p><img src="/home/git/hexo/2020/06/08/External-Interface/1.png" alt="IIC时序图"></p>
<p><img src="/home/git/hexo/2020/06/08/External-Interface/2.png" alt="IIC时序图"></p>
<h3 id="IIC实测波形"><a href="#IIC实测波形" class="headerlink" title="IIC实测波形"></a>IIC实测波形</h3><p><img src="/home/git/hexo/2020/06/08/External-Interface/1598547282809.png" alt="1598547282809"></p>
<p>​    由图中可知时序如下：</p>
<ol>
<li>由主机发起，在SCL为高电平时，SDL由高到低切边，形成开始信号；</li>
<li>接着7位地址和一位读写标志，这里7位地址为0111100，即为0x3c，最后一位0表示写操作；</li>
<li>接着再下一个时钟，主机以高电平状态释放SDA，这时从机响应，将SDA拉低；</li>
<li>接着两个8位数据00101110与响应，即0x2e；</li>
<li>还有其它数据和最后的停止位，图中被截掉了；</li>
</ol>
<h3 id="带中断的数据传输"><a href="#带中断的数据传输" class="headerlink" title="带中断的数据传输"></a>带中断的数据传输</h3><p>​    IIC只能由主机[cpu]去找外设[从机]索取数据，外设不能主动发送数据给CPU，但是CPU不能定期去问外设“你有没有数据要发给我？”，这样耗CPU的计算资源，也耗电，且无法进入睡眠状态。因此需要外设有办法通知CPU，“我有数据要发了”。<strong>I2C配合的中断信号</strong>就是这个作用。外设有数据要发了，先发个中断给CPU，CPU再来通过I2C读取外设想要发过来的数据。对于低功耗应用的场景、能够触发的外设场景，都需要这么来设计。例如电容触摸屏，平时CPU是休眠的，点击一下就唤醒系统。再例如G-Sensor运动传感器，一旦被晃动了就唤醒CPU。</p>
<p><img src="C:/Users/yangjianghe/AppData/Roaming/Typora/typora-user-images/1586839939104.png" alt="1586839939104"></p>
<p>​      发送到SDA 线上的每个字节必须为8 位，每次传输可以发送的字节数量不受限制。每个字节后必须跟一个响应位。首先传输的是数据的最高位（MSB），如果从机要完成一些其他功能后（例如一个内部中断服务程序）才能接收或发送下一个完整的数据字节，可以使时钟线SCL 保持低电平，迫使主机进入等待状态，当从机准备好接收下一个数据字节并释放时钟线SCL 后数据传输继续。</p>
<h3 id="如何一对多？"><a href="#如何一对多？" class="headerlink" title="如何一对多？"></a>如何一对多？</h3><p>​    一根I2C总线上挂载多个设备，那么岂不是CPU发个什么数据，所有的外设都可以看得到？是的，就这样子的。只不过CPU先会发一个地址，所有的外设都会收到这个地址。这个地址就好比外设的名字。叫了你了，你就答应，没叫你就别答应。</p>
<h3 id="地址冲突怎么办？"><a href="#地址冲突怎么办？" class="headerlink" title="地址冲突怎么办？"></a>地址冲突怎么办？</h3><p>​    IIC设备的地址是固定的，比如0x50，0x60等等，因为只有127个地址，因此地址冲突是很常见的，所以一般设备都会有地址选择pin。但是如果无论如何还是有芯片冲突，那就没有办法了，只能换芯片了。</p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><h4 id="EEPROM：BR24G02-3"><a href="#EEPROM：BR24G02-3" class="headerlink" title="EEPROM：BR24G02-3"></a>EEPROM：BR24G02-3</h4><p><img src="/home/git/hexo/2020/06/08/External-Interface/eeprom.png" alt="IIC实测波形"></p>
<h4 id="光感芯片：LTR-303ALS-01"><a href="#光感芯片：LTR-303ALS-01" class="headerlink" title="光感芯片：LTR-303ALS-01"></a>光感芯片：LTR-303ALS-01</h4><p>​    <img src="/home/git/hexo/2020/06/08/External-Interface/ltr.png" alt="IIC实测波形"></p>
<h2 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h2><p>​    SPI（Serial Peripheral Interface，串行外设接口）是一种<strong>高速的，全双工，同步的通信总线</strong>，并且在芯片的管脚上只占用四根线，节约了芯片的管脚，同时为PCB的布局上节省空间</p>
<p><img src="/home/git/hexo/2020/06/08/External-Interface/spi.png" alt="1586840162605"></p>
<p>​     SPI的通信原理很简单，它以<strong>主从方式</strong>工作，这种模式通常有一个主设备和一个或多个从设备，需要至少4根线，事实上3根也可以（单向传输时）。也是所有基于SPI的设备共有的，它们是SDI（数据输入），SDO（数据输出），SCK（时钟），CS（片选）。</p>
<p>​    The SPI bus specifies four logic signals:</p>
<p>​    <strong>SCLK</strong>: Serial Clock (output from master)</p>
<p>​    <strong>MOSI</strong>: Master Output Slave Input, or Master Out Slave In (data output from master)</p>
<p>​    <strong>MISO</strong>: Master Input Slave Output, or Master In Slave Out (data output from slave)</p>
<p>​    <strong>SS</strong>: Slave Select (oftenactive low, output from master) </p>
<p>​    SPI是串行通讯协议，也就是说数据是一位一位的传输的。这就是SCLK时钟线存在的原因，由SCLK提供时钟脉冲，SDI，SDO则基于此脉冲完成数据传输。数据输出通过 SDO线，数据在时钟上升沿或下降沿时改变，在紧接着的下降沿或上升沿被读取。完成一位数据传输，输入也使用同样原理。因此，至少需要8次时钟信号的改变（上沿和下沿为一次），才能完成8位数据的传输。</p>
<h3 id="SPI传输时序"><a href="#SPI传输时序" class="headerlink" title="SPI传输时序"></a>SPI传输时序</h3><p><img src="/home/git/hexo/2020/06/08/External-Interface/spi2.png" alt="1587388050644"></p>
<h3 id="SPI的缺点"><a href="#SPI的缺点" class="headerlink" title="SPI的缺点"></a>SPI的缺点</h3><p>​    没有指定的<strong>流控制</strong>，<strong>没有应答机制</strong>确认是否接收到数据。</p>
<h3 id="SPI经典连接"><a href="#SPI经典连接" class="headerlink" title="SPI经典连接"></a>SPI经典连接</h3><p><img src="/home/git/hexo/2020/06/08/External-Interface/spi_connect.png" alt="1587388050644"></p>

        </div>
    </div>
    
        
    <div class="post__license">
        <p>
            <strong>本文作者：</strong>ChrAlpha
        </p>
        
            <p>
                <strong>
                    <p>文章默认使用 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a> 协议进行许可，使用时请注意遵守协议。</p>

                </strong>
            </p>
        
        <p>
            <strong>
                本文链接：
            </strong>
            <a href="http://riveryoung.cn/2020/06/08/External-Interface/">http://riveryoung.cn/2020/06/08/External-Interface/</a>
        </p>
    </div>
 
    
    
        <div class="post-meta post-footer__meta">
    <p>
        最后更新于：2020-08-28
    </p>
</div> 
    
    
        <div class="post-cats post-card__cats">
    
        <a href="/home/git/hexo/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" class="post-cats__link button">嵌入式</a>
    
</div> 
        <div class="post-tags post-card__tags">
    
        <a href="/home/git/hexo/tags/linux/" class="post-tags__link button"># linux</a>
    
        <a href="/home/git/hexo/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" class="post-tags__link button"># 嵌入式</a>
    
</div> 
     
</article>
<br>


    </div>



    <br>
    <div class="cover">
        
            <div class="cover__menus">
                
                    <a href="/" class="cover-menu button">
                        首页
                    </a>
                    
                        <span class="separate-dot"></span>
                    
                
                    <a href="/tags/" class="cover-menu button">
                        标签
                    </a>
                    
                        <span class="separate-dot"></span>
                    
                
                    <a href="/archives/" class="cover-menu button">
                        归档
                    </a>
                    
                        <span class="separate-dot"></span>
                    
                
                    <a href="/friends/" class="cover-menu button">
                        友链
                    </a>
                    
                        <span class="separate-dot"></span>
                    
                
                    <a href="/page/" class="cover-menu button">
                        Page
                    </a>
                    
                
            </div>
        
    </div>

</main>
<footer class="footer">
     


     
  
    
        
            <p>Copyright © 2020</p>

        
    
    <p>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme - <a href="https://github.com/ChrAlpha/hexo-theme-cards" target="_blank">Cards</a></p>
</footer>


        </div>
        

 

 

 

  



 

 





    </body>
</html>
