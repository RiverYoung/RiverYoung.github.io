<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="科技呵护未来"><title>External Interface | River Young</title><link rel="stylesheet" type="text/css" href="/home/git/hexo/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/home/git/hexo/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/home/git/hexo/favicon.ico"><link rel="apple-touch-icon" href="/home/git/hexo/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/home/git/hexo/apple-touch-icon.png"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 5.1.1"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">External Interface</h1><a id="logo" href="/home/git/hexo/.">River Young</a><p class="description">爱技术/爱拍照</p></div><div id="nav-menu"><a class="current" href="/home/git/hexo/."><i class="fa fa-home"> 首页</i></a><a href="/home/git/hexo/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/home/git/hexo/about/"><i class="fa fa-user"> 关于</i></a><a href="/home/git/hexo/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">External Interface</h1><div class="post-meta">2020-06-08<span> | </span><span class="category"><a href="/home/git/hexo/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/">嵌入式</a></span></div><div class="post-content"><h1 id="外设接口"><a href="#外设接口" class="headerlink" title="外设接口"></a>外设接口</h1><h2 id="IIC"><a href="#IIC" class="headerlink" title="IIC"></a>IIC</h2><p>​    IIC(Inter-Integrated Circuit/集成电路总线），这种总线类型是一种<strong>简单、双向二线制同步串行总线</strong>。它只需要两根线（<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/SDA">SDA</a>（串行数据线）和<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/SCL">SCL</a>（串行时钟线))即可在连接于总线上的器件之间传送信息。 串行的8位双向数据传输位速率在标准模式下可达100Kbit/s，快速模式下可达400Kbit/s，高速模式下可达3．4Mbit/s。速度不快，但通用性强，适合于各种传感器、小IC，小MCU，控制指令以及小数据量的传输。</p>
<a id="more"></a>

<p>​    连接在同一IIC总线结构下的多个芯片都可以作为实时数据传输的控制源。主器件用于启动总线传送数据，并产生时钟以开放传送的器件，此时任何被寻址的器件均被认为是从器件．在总线上主和从、发和收的关系不是恒定的，而取决于此时数据传送方向。如果主机要发送数据给从器件，则主机首先寻址从器件，然后主动发送数据至从器件，最后由主机终止数据传送；如果主机要接收从器件的数据，首先由主器件寻址从器件．然后主机接收从器件发送的数据，最后由主机终止接收过程。在这种情况下．主机负责产生定时时钟和终止数据传送。</p>
<h3 id="IIC时序图"><a href="#IIC时序图" class="headerlink" title="IIC时序图"></a>IIC时序图</h3><p><img src="/home/git/hexo/home/git/hexo/2020/06/08/External-Interface/1.png" alt="IIC时序图"></p>
<p><img src="/home/git/hexo/home/git/hexo/2020/06/08/External-Interface/2.png" alt="IIC时序图"></p>
<h3 id="IIC实测波形"><a href="#IIC实测波形" class="headerlink" title="IIC实测波形"></a>IIC实测波形</h3><p><img src="/home/git/hexo/home/git/hexo/2020/06/08/External-Interface/1598547282809.png" alt="1598547282809"></p>
<p>​    由图中可知时序如下：</p>
<ol>
<li>由主机发起，在SCL为高电平时，SDL由高到低切边，形成开始信号；</li>
<li>接着7位地址和一位读写标志，这里7位地址为0111100，即为0x3c，最后一位0表示写操作；</li>
<li>接着再下一个时钟，主机以高电平状态释放SDA，这时从机响应，将SDA拉低；</li>
<li>接着两个8位数据00101110与响应，即0x2e；</li>
<li>还有其它数据和最后的停止位，图中被截掉了；</li>
</ol>
<h3 id="带中断的数据传输"><a href="#带中断的数据传输" class="headerlink" title="带中断的数据传输"></a>带中断的数据传输</h3><p>​    IIC只能由主机[cpu]去找外设[从机]索取数据，外设不能主动发送数据给CPU，但是CPU不能定期去问外设“你有没有数据要发给我？”，这样耗CPU的计算资源，也耗电，且无法进入睡眠状态。因此需要外设有办法通知CPU，“我有数据要发了”。<strong>I2C配合的中断信号</strong>就是这个作用。外设有数据要发了，先发个中断给CPU，CPU再来通过I2C读取外设想要发过来的数据。对于低功耗应用的场景、能够触发的外设场景，都需要这么来设计。例如电容触摸屏，平时CPU是休眠的，点击一下就唤醒系统。再例如G-Sensor运动传感器，一旦被晃动了就唤醒CPU。</p>
<p><img src="C:/Users/yangjianghe/AppData/Roaming/Typora/typora-user-images/1586839939104.png" alt="1586839939104"></p>
<p>​      发送到SDA 线上的每个字节必须为8 位，每次传输可以发送的字节数量不受限制。每个字节后必须跟一个响应位。首先传输的是数据的最高位（MSB），如果从机要完成一些其他功能后（例如一个内部中断服务程序）才能接收或发送下一个完整的数据字节，可以使时钟线SCL 保持低电平，迫使主机进入等待状态，当从机准备好接收下一个数据字节并释放时钟线SCL 后数据传输继续。</p>
<h3 id="如何一对多？"><a href="#如何一对多？" class="headerlink" title="如何一对多？"></a>如何一对多？</h3><p>​    一根I2C总线上挂载多个设备，那么岂不是CPU发个什么数据，所有的外设都可以看得到？是的，就这样子的。只不过CPU先会发一个地址，所有的外设都会收到这个地址。这个地址就好比外设的名字。叫了你了，你就答应，没叫你就别答应。</p>
<h3 id="地址冲突怎么办？"><a href="#地址冲突怎么办？" class="headerlink" title="地址冲突怎么办？"></a>地址冲突怎么办？</h3><p>​    IIC设备的地址是固定的，比如0x50，0x60等等，因为只有127个地址，因此地址冲突是很常见的，所以一般设备都会有地址选择pin。但是如果无论如何还是有芯片冲突，那就没有办法了，只能换芯片了。</p>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><h4 id="EEPROM：BR24G02-3"><a href="#EEPROM：BR24G02-3" class="headerlink" title="EEPROM：BR24G02-3"></a>EEPROM：BR24G02-3</h4><p><img src="/home/git/hexo/home/git/hexo/2020/06/08/External-Interface/eeprom.png" alt="IIC实测波形"></p>
<h4 id="光感芯片：LTR-303ALS-01"><a href="#光感芯片：LTR-303ALS-01" class="headerlink" title="光感芯片：LTR-303ALS-01"></a>光感芯片：LTR-303ALS-01</h4><p>​    <img src="/home/git/hexo/home/git/hexo/2020/06/08/External-Interface/ltr.png" alt="IIC实测波形"></p>
<h2 id="SPI"><a href="#SPI" class="headerlink" title="SPI"></a>SPI</h2><p>​    SPI（Serial Peripheral Interface，串行外设接口）是一种<strong>高速的，全双工，同步的通信总线</strong>，并且在芯片的管脚上只占用四根线，节约了芯片的管脚，同时为PCB的布局上节省空间</p>
<p><img src="/home/git/hexo/home/git/hexo/2020/06/08/External-Interface/spi.png" alt="1586840162605"></p>
<p>​     SPI的通信原理很简单，它以<strong>主从方式</strong>工作，这种模式通常有一个主设备和一个或多个从设备，需要至少4根线，事实上3根也可以（单向传输时）。也是所有基于SPI的设备共有的，它们是SDI（数据输入），SDO（数据输出），SCK（时钟），CS（片选）。</p>
<p>​    The SPI bus specifies four logic signals:</p>
<p>​    <strong>SCLK</strong>: Serial Clock (output from master)</p>
<p>​    <strong>MOSI</strong>: Master Output Slave Input, or Master Out Slave In (data output from master)</p>
<p>​    <strong>MISO</strong>: Master Input Slave Output, or Master In Slave Out (data output from slave)</p>
<p>​    <strong>SS</strong>: Slave Select (oftenactive low, output from master) </p>
<p>​    SPI是串行通讯协议，也就是说数据是一位一位的传输的。这就是SCLK时钟线存在的原因，由SCLK提供时钟脉冲，SDI，SDO则基于此脉冲完成数据传输。数据输出通过 SDO线，数据在时钟上升沿或下降沿时改变，在紧接着的下降沿或上升沿被读取。完成一位数据传输，输入也使用同样原理。因此，至少需要8次时钟信号的改变（上沿和下沿为一次），才能完成8位数据的传输。</p>
<h3 id="SPI传输时序"><a href="#SPI传输时序" class="headerlink" title="SPI传输时序"></a>SPI传输时序</h3><p><img src="/home/git/hexo/home/git/hexo/2020/06/08/External-Interface/spi2.png" alt="1587388050644"></p>
<h3 id="SPI的缺点"><a href="#SPI的缺点" class="headerlink" title="SPI的缺点"></a>SPI的缺点</h3><p>​    没有指定的<strong>流控制</strong>，<strong>没有应答机制</strong>确认是否接收到数据。</p>
<h3 id="SPI经典连接"><a href="#SPI经典连接" class="headerlink" title="SPI经典连接"></a>SPI经典连接</h3><p><img src="/home/git/hexo/home/git/hexo/2020/06/08/External-Interface/spi_connect.png" alt="1587388050644"></p>
</div><div class="tags"><a href="/home/git/hexo/tags/linux/"><i class="fa fa-tag"></i>linux</a><a href="/home/git/hexo/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/"><i class="fa fa-tag"></i>嵌入式</a></div><div class="post-nav"><a class="pre" href="/home/git/hexo/2020/06/20/Java%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%20%E5%8D%B7I/"></a><a class="next" href="/home/git/hexo/2020/06/06/hello-world/">Hello World</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"/><input type="hidden" name="sitesearch" value="http://riveryoung.cn/home/git/hexo"/></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/home/git/hexo/categories/java/">java</a></li><li class="category-list-item"><a class="category-list-link" href="/home/git/hexo/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/">嵌入式</a></li><li class="category-list-item"><a class="category-list-link" href="/home/git/hexo/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/">数据结构与算法</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/home/git/hexo/tags/linux/" style="font-size: 15px;">linux</a> <a href="/home/git/hexo/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F/" style="font-size: 15px;">嵌入式</a> <a href="/home/git/hexo/tags/java/" style="font-size: 15px;">java</a> <a href="/home/git/hexo/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" style="font-size: 15px;">数据结构与算法</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/home/git/hexo/2020/08/09/Data-Structures-and-Algorithm/">Data Structures and Algorithm</a></li><li class="post-list-item"><a class="post-list-link" href="/home/git/hexo/2020/06/21/java/">Java核心技术 卷I 读书心得</a></li><li class="post-list-item"><a class="post-list-link" href="/home/git/hexo/2020/06/20/Java%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF%20%E5%8D%B7I/">Java核心技术 卷I</a></li><li class="post-list-item"><a class="post-list-link" href="/home/git/hexo/2020/06/08/External-Interface/">External Interface</a></li><li class="post-list-item"><a class="post-list-link" href="/home/git/hexo/2020/06/06/hello-world/">Hello World</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/home/git/hexo/." rel="nofollow">River Young.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/home/git/hexo/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/home/git/hexo/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/copycode.js" successtext="复制成功!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/home/git/hexo/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/home/git/hexo/js/smartresize.js?v=0.0.0"></script></div></body></html>